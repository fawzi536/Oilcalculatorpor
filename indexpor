<!DOCTYPE html>
<html lang="ar" dir="rtl" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portarage Oil - Ø­Ø§Ø³Ø¨Ø© Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø²ÙŠÙˆØª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .floating-oil {
            animation: float 6s ease-in-out infinite;
        }
        
        .gold-gradient {
            background: linear-gradient(135deg, #FFD700, #FFA500, #FFD700);
            background-size: 200% 200%;
            animation: shimmer 3s linear infinite;
        }
        
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .oil-drop {
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #FFD700, #FFA500);
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            position: absolute;
            animation: float 4s ease-in-out infinite;
        }
        
        .btn-gold {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }
        
        .btn-gold:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.5);
        }
        
        .input-gold {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid rgba(255, 215, 0, 0.5);
            color: #FFD700;
            transition: all 0.3s ease;
        }
        
        .input-gold:focus {
            border-color: #FFD700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            outline: none;
        }
    </style>
</head>
<body class="h-full bg-black text-white overflow-x-hidden">
    <!-- Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© -->
    <div class="fixed inset-0 z-0">
        <div class="oil-drop" style="top: 10%; left: 10%; animation-delay: 0s;"></div>
        <div class="oil-drop" style="top: 20%; right: 15%; animation-delay: 1s;"></div>
        <div class="oil-drop" style="top: 60%; left: 20%; animation-delay: 2s;"></div>
        <div class="oil-drop" style="top: 80%; right: 25%; animation-delay: 3s;"></div>
        <div class="oil-drop" style="top: 40%; right: 10%; animation-delay: 4s;"></div>
    </div>

    <main class="relative z-10 min-h-full p-8">
        <div class="max-w-7xl mx-auto">
            <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
            <header class="text-center mb-12">
                <h1 class="text-8xl font-bold mb-6 gold-gradient bg-clip-text text-transparent">
                    Portarage Oil
                </h1>
                <p class="text-3xl text-gray-300">Ø­Ø§Ø³Ø¨Ø© Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø²ÙŠÙˆØª ÙˆØ§Ù„ÙÙ„Ø§ØªØ±</p>
            </header>

            <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
            <div class="glass-effect rounded-3xl p-12 mb-12">
                <!-- Ø§Ù„Ø®Ø·ÙˆØ© 1: ÙƒÙ…ÙŠØ© Ø§Ù„Ø²ÙŠØª -->
                <div id="step1" class="step">
                    <h2 class="text-4xl font-bold mb-8 text-center text-yellow-400">
                        ÙƒÙ… Ù„ØªØ± ØªØ­ØªØ§Ø¬ØŸ
                    </h2>
                    <div class="text-center">
                        <input type="number" id="litersInput" min="1" max="50" 
                               placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ù„ØªØ±Ø§Øª" 
                               class="input-gold text-center text-4xl p-6 rounded-xl w-96">
                        <p class="text-gray-400 mt-4 text-xl">Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</p>
                    </div>
                </div>

                <!-- Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø§Ø®ØªÙŠØ§Ø± Ø¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© -->
                <div id="step2" class="step hidden">
                    <div class="mb-6">
                        <button onclick="showStep('step1')" 
                                class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-colors text-lg">
                            â† Ø±Ø¬ÙˆØ¹
                        </button>
                    </div>
                    <h2 class="text-4xl font-bold mb-8 text-center text-yellow-400">
                        Ø§Ø®ØªØ± Ø¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                    </h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-6" id="viscosityOptions">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    </div>
                </div>

                <!-- Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø²ÙŠØª -->
                <div id="step3" class="step hidden">
                    <div class="mb-6">
                        <button onclick="showStep('step2')" 
                                class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-colors text-lg">
                            â† Ø±Ø¬ÙˆØ¹
                        </button>
                    </div>
                    <h2 class="text-4xl font-bold mb-8 text-center text-yellow-400">
                        Ø§Ø®ØªØ± Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ø²ÙŠØª
                    </h2>
                    <div class="mb-6">
                        <input type="text" id="oilSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø§Ø±ÙƒØ©..." 
                               class="input-gold w-full p-6 rounded-xl text-xl">
                    </div>
                    <div id="oilOptions" class="grid gap-6">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    </div>
                </div>

                <!-- Ø§Ù„Ø®Ø·ÙˆØ© 4: Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
                <div id="step4" class="step hidden">
                    <div class="mb-6">
                        <button onclick="showStep('step3')" 
                                class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-colors text-lg">
                            â† Ø±Ø¬ÙˆØ¹
                        </button>
                    </div>
                    <h2 class="text-4xl font-bold mb-8 text-center text-yellow-400">
                        Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù„Ù„ÙÙ„ØªØ±
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <button onclick="selectCarType('german', 12)" 
                                class="btn-gold text-black font-bold p-8 rounded-xl text-2xl">
                            Ø£Ù„Ù…Ø§Ù†ÙŠØ© - 12 Ø¯.Ùƒ
                        </button>
                        <button onclick="selectCarType('other', 8)" 
                                class="btn-gold text-black font-bold p-8 rounded-xl text-2xl">
                            Ø£Ù…Ø±ÙŠÙƒÙŠØ© / ÙŠØ§Ø¨Ø§Ù†ÙŠØ© / ÙƒÙˆØ±ÙŠØ© - 8 Ø¯.Ùƒ
                        </button>
                    </div>
                </div>

                <!-- Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© -->
                <div id="finalResult" class="step hidden">
                    <h2 class="text-5xl font-bold mb-8 text-center text-yellow-400">
                        Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
                    </h2>
                    <div class="glass-effect rounded-2xl p-8 mb-8">
                        <div id="invoiceDetails" class="space-y-6 text-xl">
                            <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
                        </div>
                    </div>
                    <div class="text-center space-y-6">
                        <button onclick="copyMessage()" 
                                class="bg-blue-600 hover:bg-blue-700 text-white font-bold px-12 py-6 rounded-xl text-2xl transition-colors">
                            Ù†Ø³Ø®
                        </button>
                        <button onclick="resetCalculation()" 
                                class="btn-gold text-black font-bold px-12 py-6 rounded-xl text-2xl">
                            Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let oilData = [];
        let selectedViscosity = '';
        let selectedOil = null;
        let liters = 0;
        let filterPrice = 0;
        let servicePrice = 15;

        // ØªØ±Ø¬Ù…Ø© Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª
        function translateBrand(brand) {
            switch(brand.toUpperCase()) {
                case "GAZPROMNEFT": return "ØºØ§Ø²Ø¨Ø±ÙˆÙ… Ù†ÙØ· Ø±ÙˆØ³ÙŠ ğŸ‡·ğŸ‡º";
                case "TOTAL": return "ØªÙˆØªØ§Ù„ ÙØ±Ù†Ø³ÙŠ ğŸ‡«ğŸ‡·";
                case "TOYOTA": return "ØªÙˆÙŠÙˆØªØ§ ÙŠØ§Ø¨Ø§Ù†ÙŠ ğŸ‡¯ğŸ‡µ";
                case "LEXUS": return "Ù„ÙƒØ²Ø³ ÙŠØ§Ø¨Ø§Ù†ÙŠ ğŸ‡¯ğŸ‡µ";
                case "G-ENERGY": return "Ø¬ÙŠ-Ø¥Ù†Ø±Ø¬ÙŠ Ø¥ÙŠØ·Ø§Ù„ÙŠ ğŸ‡®ğŸ‡¹";
                case "BIZOL": return "Ø¨ÙŠØ²ÙˆÙ„ Ø§Ù„Ù…Ø§Ù†ÙŠ ğŸ‡©ğŸ‡ª";
                case "MOBIL ONE": return "Ù…ÙˆØ¨ÙŠÙ„ ÙˆÙ† Ø§ÙˆØ±Ø¨ÙŠ ğŸ‡ªğŸ‡º";
                case "MOPAR": return "Ù…ÙˆØ¨Ø§Ø± Ø§Ù…Ø±ÙŠÙƒÙŠ ğŸ‡ºğŸ‡¸";
                case "AC DELCO": return "Ø§Ø³ÙŠ Ø¯ÙŠÙ„ÙƒÙˆ Ø§Ù…Ø±ÙŠÙƒÙŠ ğŸ‡ºğŸ‡¸";
                case "LIQUI MOLY": return "Ù„ÙŠÙƒÙŠ Ù…ÙˆÙ„ÙŠ Ø§Ù…Ø±ÙŠÙƒÙŠ ğŸ‡ºğŸ‡¸";
                case "MOTORCRAFT": return "Ù…ÙˆØªØ±ÙƒØ±Ø§ÙØª Ø§Ù…Ø±ÙŠÙƒÙŠ ğŸ‡ºğŸ‡¸";
                case "CEPSA GENUINE": return "Ø³ÙŠØ³Ø¨Ø§ Ø§Ø³Ø¨Ø§Ù†ÙŠ ğŸ‡ªğŸ‡¸";
                case "DUCHAMS": return "Ø¯Ø§ÙƒÙ‡Ø§Ù… Ø¨Ø±ÙŠØ·Ø§Ù†ÙŠ ğŸ‡¬ğŸ‡§";
                case "WAGNER": return "ÙˆØ§Ø¬Ù†Ø± Ø§Ù„Ù…Ø§Ù†ÙŠ ğŸ‡©ğŸ‡ª";
                case "RAVENOL": return "Ø±ÙŠÙÙ†ÙˆÙ„ Ø§Ù„Ù…Ø§Ù†ÙŠ ğŸ‡©ğŸ‡ª";
                case "CASTROL": return "ÙƒØ§Ø³ØªØ±ÙˆÙ„ ğŸ‡¬ğŸ‡§";
                case "EGON RACING": return "Ø¥ÙŠØºÙˆÙ† Ø±ÙŠØ³Ù†Ø¬";
                case "SHELL HELIX ULTRA": return "Ø´Ù„ Ù‡ÙŠÙ„ÙŠÙƒØ³ Ø£Ù„ØªØ±Ø§ Ø¹Ù…Ø§Ù†ÙŠ ğŸ‡´ğŸ‡²";
                default: return brand;
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets
        async function loadOilData() {
            try {
                console.log('Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets...');
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Google Sheets API Ø§Ù„Ø¹Ø§Ù…Ø©
                const sheetId = '1eZ8_HdYIOpp1dSqLVdZ4OP-Y4FHWa7lW';
                const range = 'A:G';
                const gid = '1'; // Ù„Ù„Ù…Ù„Ù Ø§Ù„Ø«Ø§Ù†ÙŠ "Stock"
                
                // Ø¬Ø±Ø¨ Ø¹Ø¯Ø© Ø·Ø±Ù‚ Ù…Ø®ØªÙ„ÙØ©
                const urls = [
                    `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv&gid=${gid}`,
                    `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&gid=${gid}`,
                    `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=AIzaSyBhuKVRdSkDjKA-9XLZmVkbvFXZvBqVzSI`
                ];
                
                for (let i = 0; i < urls.length; i++) {
                    try {
                        console.log(`Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø±Ø§Ø¨Ø· ${i + 1}:`, urls[i]);
                        
                        const response = await fetch(urls[i], {
                            method: 'GET',
                            headers: {
                                'Accept': 'text/csv,application/json,*/*'
                            }
                        });
                        
                        if (response.ok) {
                            const contentType = response.headers.get('content-type');
                            let data;
                            
                            if (contentType && contentType.includes('json')) {
                                data = await response.json();
                                parseGoogleSheetsJSON(data);
                            } else {
                                data = await response.text();
                                parseCSVData(data);
                            }
                            
                            if (oilData.length > 0) {
                                console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·', i + 1);
                                return;
                            }
                        }
                    } catch (error) {
                        console.log(`ÙØ´Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· ${i + 1}:`, error.message);
                        continue;
                    }
                }
                
                throw new Error('ÙØ´Ù„ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„');
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                loadSampleData();
            }
        }

        // ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª JSON Ù…Ù† Google Sheets API
        function parseGoogleSheetsJSON(data) {
            try {
                if (data.values && Array.isArray(data.values)) {
                    oilData = [];
                    // ØªØ®Ø·ÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø±
                    for (let i = 1; i < data.values.length; i++) {
                        const row = data.values[i];
                        if (!row || row.length < 7) continue;
                        
                        const brand = row[0] ? row[0].toString().trim() : '';
                        const type = row[1] ? row[1].toString().trim() : '';
                        const price = parseFloat(row[2]) || 0;
                        const available = parseFloat(row[6]) || 0;
                        
                        if (brand && type && price > 0 && available > 0) {
                            oilData.push({
                                brand: brand,
                                type: type,
                                available: available,
                                price: price
                            });
                        }
                    }
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ JSON:', error);
            }
        }

        // ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª CSV
        function parseCSVData(csvText) {
            try {
                const lines = csvText.trim().split('\n');
                oilData = [];
                
                // ØªØ®Ø·ÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø±
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i];
                    if (!line.trim()) continue;
                    
                    const values = parseCSVLine(line);
                    const brand = values[0] ? values[0].trim().replace(/"/g, '') : '';
                    const type = values[1] ? values[1].trim().replace(/"/g, '') : '';
                    const price = parseFloat(values[2]) || 0;
                    const available = parseFloat(values[6]) || 0;
                    
                    if (brand && type && price > 0 && available > 0) {
                        oilData.push({
                            brand: brand,
                            type: type,
                            available: available,
                            price: price
                        });
                    }
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ CSV:', error);
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù„ÙŠÙ„ Ø³Ø·Ø± CSV
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim());
            return result;
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„
        function loadSampleData() {
            console.log('ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©...');
            oilData = [
                {brand: "GAZPROMNEFT", type: "5W-30", available: 20, price: 3.5},
                {brand: "GAZPROMNEFT", type: "5W-40", available: 15, price: 3.8},
                {brand: "TOTAL", type: "5W-30", available: 25, price: 4.2},
                {brand: "TOTAL", type: "5W-40", available: 18, price: 4.5},
                {brand: "TOYOTA", type: "5W-30", available: 12, price: 5.0},
                {brand: "LEXUS", type: "5W-30", available: 10, price: 5.5},
                {brand: "G-ENERGY", type: "5W-30", available: 22, price: 3.2},
                {brand: "G-ENERGY", type: "5W-40", available: 16, price: 3.4},
                {brand: "BIZOL", type: "5W-30", available: 14, price: 4.8},
                {brand: "MOBIL ONE", type: "5W-30", available: 20, price: 6.0},
                {brand: "CASTROL", type: "5W-30", available: 18, price: 5.2},
                {brand: "SHELL HELIX ULTRA", type: "5W-30", available: 15, price: 5.8}
            ];
            
            console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©:', oilData.length, 'Ø¹Ù†ØµØ±');
        }



        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„ Ø³Ø§Ø¹Ø©
        function startAutoRefresh() {
            setInterval(() => {
                console.log('ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
                loadOilData();
            }, 60 * 60 * 1000); // ÙƒÙ„ Ø³Ø§Ø¹Ø©
        }

        function setupLitersInput() {
            const litersInput = document.getElementById('litersInput');
            if (litersInput) {
                litersInput.oninput = function(e) {
                    liters = parseInt(e.target.value) || 0;
                    if (liters > 0) {
                        setTimeout(() => {
                            showStep('step2');
                            displayViscosityOptions();
                        }, 500);
                    }
                };
            }
        }

        function displayViscosityOptions() {
            // ÙÙ„ØªØ±Ø© Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ù„Ø²ÙˆØ¬Ø© Ø§Ù„Ù…ØªÙˆÙØ±Ø© Ø¨ÙƒÙ…ÙŠØ© ÙƒØ§ÙÙŠØ©
            const availableTypes = oilData.filter(item => item.available >= liters);
            const viscosities = [...new Set(availableTypes.map(item => item.type))];
            const container = document.getElementById('viscosityOptions');
            
            if (viscosities.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center text-red-400 text-xl">
                        Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø²ÙŠÙˆØª Ù…ØªÙˆÙØ±Ø© Ø¨Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (${liters} Ù„ØªØ±)
                    </div>
                `;
                return;
            }
            
            container.innerHTML = viscosities.map(viscosity => `
                <button onclick="selectViscosity('${viscosity}')" 
                        class="btn-gold text-black font-bold p-6 rounded-xl text-2xl hover:scale-105 transition-transform">
                    ${viscosity}
                </button>
            `).join('');
        }

        function selectViscosity(viscosity) {
            selectedViscosity = viscosity;
            showStep('step3');
            displayOilOptions();
        }

        function displayOilOptions() {
            // ÙÙ„ØªØ±Ø© Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ù…ØªÙˆÙØ±Ø© Ø¨Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙˆØ¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
            const filteredOils = oilData.filter(item => 
                item.type === selectedViscosity && item.available >= liters
            );
            const container = document.getElementById('oilOptions');
            
            function renderOils(oils) {
                if (oils.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-red-400 text-xl">
                            Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø§Ø±ÙƒØ§Øª Ù…ØªÙˆÙØ±Ø© Ø¨Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = oils.map(oil => `
                    <div onclick="selectOil('${oil.brand}', ${oil.price})" 
                         class="glass-effect p-6 rounded-xl cursor-pointer hover:bg-yellow-900 hover:bg-opacity-20 transition-all border-2 border-transparent hover:border-yellow-500">
                        <h3 class="text-2xl font-bold text-yellow-400">${translateBrand(oil.brand)}</h3>
                        <p class="text-gray-300 text-lg">Ø§Ù„Ù„Ø²ÙˆØ¬Ø©: ${oil.type}</p>
                        <p class="text-gray-300 text-lg">Ù…ØªÙˆÙØ±: ${oil.available} Ù„ØªØ±</p>
                        <p class="text-xl font-bold text-green-400">${oil.price} Ø¯.Ùƒ / Ù„ØªØ±</p>
                    </div>
                `).join('');
            }
            
            renderOils(filteredOils);
            
            // Ø§Ù„Ø¨Ø­Ø«
            document.getElementById('oilSearch').oninput = function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const filtered = filteredOils.filter(oil => 
                    oil.brand.toLowerCase().includes(searchTerm)
                );
                renderOils(filtered);
            };
        }

        function selectOil(brandName, price) {
            selectedOil = {name: brandName, price: price};
            showStep('step4');
        }

        function selectCarType(type, price) {
            filterPrice = price;
            showStep('finalResult');
            displayFinalResult();
        }

        function displayFinalResult() {
            const oilTotal = selectedOil.price * liters;
            const grandTotal = oilTotal + filterPrice + servicePrice;
            
            document.getElementById('invoiceDetails').innerHTML = `
                <div class="border-b border-yellow-600 pb-6">
                    <h3 class="text-2xl font-bold text-yellow-400 mb-4">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨:</h3>
                    <p class="text-lg"><span class="text-gray-400">Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ø²ÙŠØª:</span> ${translateBrand(selectedOil.name)}</p>
                    <p class="text-lg"><span class="text-gray-400">Ø¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø©:</span> ${selectedViscosity}</p>
                    <p class="text-lg"><span class="text-gray-400">Ø§Ù„ÙƒÙ…ÙŠØ©:</span> ${liters} Ù„ØªØ±</p>
                </div>
                <div class="border-b border-yellow-600 pb-6">
                    <h3 class="text-2xl font-bold text-yellow-400 mb-4">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙƒÙ„ÙØ©:</h3>
                    <div class="flex justify-between text-lg"><span>Ø§Ù„Ø²ÙŠØª (${liters} Ã— ${selectedOil.price})</span><span>${oilTotal.toFixed(2)} Ø¯.Ùƒ</span></div>
                    <div class="flex justify-between text-lg"><span>Ø§Ù„ÙÙ„ØªØ±</span><span>${filterPrice} Ø¯.Ùƒ</span></div>
                    <div class="flex justify-between text-lg"><span>Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©</span><span>${servicePrice} Ø¯.Ùƒ</span></div>
                </div>
                <div class="text-4xl font-bold text-center">
                    <span class="text-yellow-400">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: </span>
                    <span class="text-green-400">${grandTotal.toFixed(2)} Ø¯.Ùƒ</span>
                </div>
            `;
        }

        function showStep(stepId) {
            document.querySelectorAll('.step').forEach(step => step.classList.add('hidden'));
            document.getElementById(stepId).classList.remove('hidden');
        }

        function copyMessage() {
            const oilTotal = selectedOil.price * liters;
            const grandTotal = oilTotal + filterPrice + servicePrice;
            
            const message = `Ù…ØªÙˆÙØ± Ø²ÙŠØª ${translateBrand(selectedOil.name)} (${liters}) Ù„ØªØ± ÙˆØ¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© ${selectedViscosity} Ù…Ø¹ Ø§Ù„ÙÙ„ØªØ± Ù…Ù† Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ Ù…Ø¹ ÙØ­Øµ Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù…Ø³ØªÙˆÙ‰ ØºØ§Ø² Ø§Ù„Ù…ÙƒÙŠÙ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¨Ø±Ù…Ø¬Ø© Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø®Ø¯Ù…Ø© Ø¬Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØª Ø¨Ù‚ÙŠÙ…Ø© ${grandTotal.toFixed(2)} Ø¯Ùƒ`;
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±
            const copyBtn = document.querySelector('button[onclick="copyMessage()"]');
            const originalText = copyBtn.textContent;
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù†Ø³Ø® Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Clipboard API
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(message).then(() => {
                    // Ù†Ø¬Ø­ Ø§Ù„Ù†Ø³Ø®
                    copyBtn.textContent = 'ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ“';
                    copyBtn.classList.add('bg-green-600');
                    copyBtn.classList.remove('bg-blue-600');
                    
                    setTimeout(() => {
                        copyBtn.textContent = originalText;
                        copyBtn.classList.remove('bg-green-600');
                        copyBtn.classList.add('bg-blue-600');
                    }, 2000);
                }).catch(() => {
                    // ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø® - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©
                    fallbackCopy(message, copyBtn, originalText);
                });
            } else {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
                fallbackCopy(message, copyBtn, originalText);
            }
        }

        // Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø¯ÙŠÙ„Ø© Ù„Ù„Ù†Ø³Ø®
        function fallbackCopy(text, button, originalText) {
            try {
                // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± textarea Ù…Ø¤Ù‚Øª
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù†Ø³Ø®
                const successful = document.execCommand('copy');
                document.body.removeChild(textArea);
                
                if (successful) {
                    button.textContent = 'ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ“';
                    button.classList.add('bg-green-600');
                    button.classList.remove('bg-blue-600');
                } else {
                    button.textContent = 'ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø® âœ—';
                    button.classList.add('bg-red-600');
                    button.classList.remove('bg-blue-600');
                }
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('bg-green-600', 'bg-red-600');
                    button.classList.add('bg-blue-600');
                }, 2000);
                
            } catch (err) {
                console.error('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ù†Ø³Ø®:', err);
                button.textContent = 'ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø® âœ—';
                button.classList.add('bg-red-600');
                button.classList.remove('bg-blue-600');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('bg-red-600');
                    button.classList.add('bg-blue-600');
                }, 2000);
            }
        }

        function resetCalculation() {
            selectedViscosity = '';
            selectedOil = null;
            liters = 0;
            filterPrice = 0;
            document.getElementById('oilSearch').value = '';
            document.getElementById('litersInput').value = '';
            showStep('step1');
            setupLitersInput();
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        loadOilData().then(() => {
            setupLitersInput();
            startAutoRefresh();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9937c59c36d05d9b',t:'MTc2MTI5MTA1OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
